#!/bin/bash

pushd ${SP_SRC_DIR}/docker

# startup env
docker-compose up -d

# init hdfs path
while [ $(docker exec -it sp-hdfs /usr/local/hadoop/bin/hdfs dfs -mkdir /sptest) != "" ]; do
    sleep 1 # waiting to pass hdfs safe mode
done
docker exec -it sp-hdfs /usr/local/hadoop/bin/hdfs dfs -ls /user

bin/hdfs dfs -mkdir /user.sptest 2>/dev/null && echo 1 || echo 2

# create topic "sptest"
docker exec -it sp-kafka /usr/bin/kafka-topics --create --bootstrap-server sp-kafka:9092 --topic sptest --replication-factor 1 --partitions 3

popd